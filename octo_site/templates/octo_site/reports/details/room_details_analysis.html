{% include 'octo_site/includes/header_reports.html' %}
<!-- CONTENT -->
{% load staticfiles %}
	<script src="{% static 'octo_site/res/Chart.js/Chart.bundle.js' %}"></script>
	<script src="{% static 'octo_site/res/Chart.js/samples/utils.js' %}"></script>

	<style>
	canvas{
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
    .myProgress {
      width: 80px;
    }
    .myBar {
      width: 100%;
      height: 15px;
      background-color: cornflowerblue;
    }
	</style>
<div id="content" style="padding: 0 0 0 0; margin-left: 0px;" uk-height-viewport>
    <section class="uk-section uk-article" style="background-color: #f7f7f7;padding: 0px" >
        <div class="uk-width-1-1" style="padding-right: 2vw;padding-left: 2vw;padding-top: 4vh;background-color: white ">
            <div class="uk-grid" >
                <div class="uk-width-auto uk-text-left" >
                    <h4 class="uk-margin-remove-bottom uk-text-center"><span  class="uk-text-primary" data-uk-icon="icon: gitter;ratio: 1.5;"></span> <b>{{ room.room_name }}</b> Report {{ msg }}</h4>
                </div>

                <div class="uk-width-expand uk-text-right">
                    <label uk-tooltip="Show Reports with a summary chart"><input class="uk-checkbox" type="checkbox" onclick="show_chart(this)"> Chart</label> |
                    <label uk-tooltip="Show summary insights"><input class="uk-checkbox" type="checkbox"  onclick="show_summary(this)" checked> Summary</label> |
                    <a href="#" uk-tooltip="Print Report" ><i class="fa fa-print" style="font-size: 22px"></i></a>
                </div>
            </div>
            <div class="uk-container-expand" id="chart_container" style="display:none;height: 60vh">
                <div class="chart-container" style="margin-left: 15vw;height:20vh;width:70%" >
                    <canvas class="uk-align-center" id="canvas" ></canvas>
                </div>
            </div>
            <br>
        </div>

        <div class="uk-grid uk-grid-divider uk-grid-medium uk-child-width-1-4 uk-child-width-1-6@l uk-child-width-1-5@xl" id="summary_container" style="background-color:#f7f7f7;padding: 20px;margin-left:0px" data-uk-grid>
                    <div>
                        <span class="uk-text-small"><span data-uk-icon="icon:users" class="uk-margin-small-right uk-text-primary"></span>New Users</span>
                        <h1 class="uk-heading-secondary uk-margin-remove  uk-text-primary">2.134</h1>
                        <div class="uk-text-small">
                            <span class="uk-text-success" data-uk-icon="icon: triangle-up">15%</span> more than last week.
                        </div>
                    </div>
                    <div>
                        <span class="uk-text-small"><span data-uk-icon="icon:social" class="uk-margin-small-right uk-text-primary"></span>Social Media</span>
                        <h1 class="uk-heading-secondary uk-margin-remove uk-text-primary">8.490</h1>
                        <div class="uk-text-small">
                            <span class="uk-text-warning" data-uk-icon="icon: triangle-down">-15%</span> less than last week.
                        </div>
                    </div>
                    <div>
                        <span class="uk-text-small"><span data-uk-icon="icon:clock" class="uk-margin-small-right uk-text-primary"></span>Traffic hours</span>
                        <h1 class="uk-heading-secondary uk-margin-remove uk-text-primary">12.00<small class="uk-text-small">PM</small></h1>
                        <div class="uk-text-small">
                            <span class="uk-text-success" data-uk-icon="icon: triangle-up"> 19%</span> more than last week.
                        </div>

                    </div>
                    <div>
                        <span class="uk-text-small"><span data-uk-icon="icon:search" class="uk-margin-small-right uk-text-primary"></span>Week Search</span>
                        <h1 class="uk-heading-secondary uk-margin-remove uk-text-primary">9.543</h1>
                        <div class="uk-text-small">
                            <span class="uk-text-danger" data-uk-icon="icon: triangle-down"> -23%</span> less than last week.
                        </div>
                    </div>
                    <div>
                        <span class="uk-text-small"><span data-uk-icon="icon:clock" class="uk-margin-small-right uk-text-primary"></span>Traffic hours</span>
                        <h1 class="uk-heading-secondary uk-margin-remove uk-text-primary">12.00<small class="uk-text-small">PM</small></h1>
                        <div class="uk-text-small">
                            <span class="uk-text-success" data-uk-icon="icon: triangle-up"> 19%</span> more than last week.
                        </div>
                    </div>
                    <div>
                        <span class="uk-text-small"><span data-uk-icon="icon:search" class="uk-margin-small-right uk-text-primary"></span>Week Search</span>
                        <h1 class="uk-heading-secondary uk-margin-remove uk-text-primary">9.543</h1>
                        <div class="uk-text-small">
                            <span class="uk-text-danger" data-uk-icon="icon: triangle-down"> -23%</span> less than last week.
                        </div>
                    </div>
                </div>

                    <hr class="uk-divider-icon">
        <div class="uk-container-medium" style="background-color:#f7f7f7;margin-left:5vw;margin-right:3vw;margin-top: 2vh">
            <div class="uk-card uk-card-default uk-card-small uk-card-hover" style="background-color: #2e3135">
            <div class="uk-card-header">
                <div class="uk-grid uk-grid-medium" >
                        <div class="uk-width-auto" >
                            <h4 class="uk-margin-remove-bottom uk-text-primary"><span class="uk-text-primary" data-uk-icon="icon: list;ratio: 1"></span> List of Games Included </h4>
                        </div>
                        <div class="uk-width-expand uk-text-right">
                            <button class="uk-button uk-button-primary uk-button-small hobor" style="color: white">New Branch <span data-uk-icon="icon: plus"></span></button>
                            <button class="uk-button uk-button-primary uk-button-small hobor" style="color: white" disabled>New Room <span data-uk-icon="icon: plus"></span></button>
                        </div>
                        <div class="uk-card-body uk-align-center uk-width-1-1">
                            <div class="uk-overflow-auto">
                                     <table id="room_tbl" class="uk-table uk-table-hover" style="width:100%">
                                          <thead>
                                              <tr>
                                                  <th class="uk-table-shrink uk-text-nowrap"></th>
                                                  <th class="uk-width-small">Match ID</th>
                                                  <th class="uk-width-medium">Time Start & End</th>
                                                  <th class="uk-width-medium">Team name</th>
                                                  <th class="uk-width-medium">Duration</th>
                                              </tr>
                                          </thead>
                                          <tbody>
                                          {% load static %}
                                                <tr class="tbl_toggle">

                                                    <td class="uk-text-center"><input class="uk-checkbox" value="gago" name="room_to_analyze[]" type="checkbox"></td>
                                                    <td>
                                                        <a>10023401</a>
                                                        <br>
                                                        <p class="uk-text-small" style="margin-top: 0px">Feb 13, 2018</p>
                                                    </td>

                                                    <td>
                                                        <p class="uk-text-small" style="margin: 0px">12:00:00 pm to 13:00:00 pm</p>
                                                    </td>
                                                    <td>
                                                        <p  style="margin: 0px"><b style="color: #A4C38D">Dogdo Markerino</b></p>
                                                        <p class="uk-text-small" style="margin-top: 0px">4 clues asked</p>
                                                    </td>
                                                    <td>
                                                        <p class="uk-text-small" style="margin-top: 0px;color: orange"><b>34 minutes</b></p>
                                                        <div class="myProgress">
                                                          <div class="myBar"></div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="tbl_toggle">
                                                    <td class="uk-text-center"><input class="uk-checkbox" value="gago" name="room_to_analyze[]" type="checkbox"></td>
                                                    <td>
                                                        <a>10023401</a>
                                                        <br>
                                                        <p class="uk-text-small" style="margin-top: 0px">Feb 13, 2018</p>
                                                    </td>

                                                    <td>
                                                        <p class="uk-text-small" style="margin: 0px">12:00:00pm</p>
                                                        <p class="uk-text-small" style="margin: 0px">13:00:00pm</p>
                                                    </td>
                                                    <td>
                                                        <p  style="margin: 0px">Dogdo Markerino</p>
                                                        <p class="uk-text-small" style="margin-top: 0px">4 clues asked</p>
                                                    </td>
                                                    <td>
                                                        <p class="uk-text-small" style="margin-top: 0px">34 mins</p>
                                                        <div class="myProgress">
                                                          <div class="myBar" style="width: 60%"></div>
                                                        </div>
                                                    </td>
                                                </tr>
                                          </tbody>
                                     </table>
                                    <script>
                                        $(document).ready(function() {
                                        $('#example').DataTable();
                                        } );
                                        $(document).ready(function() {
                                        $('#room_tbl').DataTable();
                                        });
                                    </script>
                                    </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

	<script>
        let to_add=[];
        let sensor_data;
		let MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
		let config = {
			type: 'bar',
			data: {
				labels: [],
				datasets: [{
					label: 'Time Triggered at',
					backgroundColor: window.chartColors.red,
					borderColor: window.chartColors.red,
					data: [],
					fill: false,
				}]
			},
			options: {
				responsive: true,

				title: {
					display: true,
					text: '{{ room.room_name }} Game #69'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Sensor Name'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'seconds'
						}
					}]
				}
			}
		};

		window.onload = function() {
			var ctx = document.getElementById('canvas').getContext('2d');
			window.myLine = new Chart(ctx, config);
			initData();
            console.log("started");
			//window.setInterval(reloadData, 1000);

		};
		$(".tbl_toggle").click(function(e) {
            var chk = $(this).find("input:checkbox").get(0);
            console.log("clicked");
            if(e.target !== chk)
            {
                chk.checked = !chk.checked;
            }
        });
        function show_chart(obj) {
            if($(obj).is(':checked'))
                $("#chart_container").fadeIn();
            else
                $("#chart_container").fadeOut();
        }
        function show_summary(obj) {
            if($(obj).is(':checked'))
                $("#summary_container").fadeIn();
            else
                $("#summary_container").fadeOut();
        }
        function initData() {
           sensor_data =  $.get("/octo_site/sensor_data/2");
           sensor_data.done(function(results){

                obj = results.data;

                for (i in obj)
                {
                   // console.log(obj[i]);
                    config.data.labels.push(obj[i].sensor_name);
			        config.data.datasets[0].data.push(obj[i].value);

			    window.myLine.update()
                }
           });

			window.myLine.update();
        }

	</script>
{% include 'octo_site/includes/offcanvas_reports.html' %}

